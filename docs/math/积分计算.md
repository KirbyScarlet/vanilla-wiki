# 积分计算

## $\int\frac{x}{1+\sin x}\mathrm{d}x$

要计算积分 $\int \frac{x}{1 + \sin x}  dx$，首先对分母进行简化。利用三角恒等式 $1 + \sin x = (\sin \frac{x}{2} + \cos \frac{x}{2})^2$，积分化为：
$$
\int \frac{x}{(\sin \frac{x}{2} + \cos \frac{x}{2})^2}  dx.
$$
令 $t = \frac{x}{2}$，则 $x = 2t$，$dx = 2  dt$，代入得：
$$
\int \frac{2t}{(\sin t + \cos t)^2} \cdot 2  dt = 4 \int \frac{t}{(\sin t + \cos t)^2}  dt.
$$
将 $\sin t + \cos t$ 化为单一三角函数形式：
$$
\sin t + \cos t = \sqrt{2} \sin\left(t + \frac{\pi}{4}\right),
$$
所以：
$$
(\sin t + \cos t)^2 = \left( \sqrt{2} \sin\left(t + \frac{\pi}{4}\right) \right)^2 = 2 \sin^2\left(t + \frac{\pi}{4}\right).
$$
积分变为：
$$
4 \int \frac{t}{2 \sin^2\left(t + \frac{\pi}{4}\right)}  dt = 2 \int t \csc^2\left(t + \frac{\pi}{4}\right)  dt.
$$
使用分部积分法，令 $u = t$，$dv = \csc^2\left(t + \frac{\pi}{4}\right)  dt$，则 $du = dt$，$v = -\cot\left(t + \frac{\pi}{4}\right)$：
$$
\int t \csc^2\left(t + \frac{\pi}{4}\right)  dt = -t \cot\left(t + \frac{\pi}{4}\right) - \int \left( -\cot\left(t + \frac{\pi}{4}\right) \right)  dt = -t \cot\left(t + \frac{\pi}{4}\right) + \int \cot\left(t + \frac{\pi}{4}\right)  dt.
$$
其中 $\int \cot \theta  d\theta = \ln |\sin \theta| + C$，所以：
$$
\int \cot\left(t + \frac{\pi}{4}\right)  dt = \ln \left| \sin\left(t + \frac{\pi}{4}\right) \right| + C.
$$
代回：
$$
\int t \csc^2\left(t + \frac{\pi}{4}\right)  dt = -t \cot\left(t + \frac{\pi}{4}\right) + \ln \left| \sin\left(t + \frac{\pi}{4}\right) \right| + C.
$$
乘以 2：
$$
2 \int t \csc^2\left(t + \frac{\pi}{4}\right)  dt = 2 \left[ -t \cot\left(t + \frac{\pi}{4}\right) + \ln \left| \sin\left(t + \frac{\pi}{4}\right) \right| \right] + C.
$$
将 $t = \frac{x}{2}$ 代回：
$$
2 \left[ -\frac{x}{2} \cot\left(\frac{x}{2} + \frac{\pi}{4}\right) + \ln \left| \sin\left(\frac{x}{2} + \frac{\pi}{4}\right) \right| \right] + C = -x \cot\left(\frac{x}{2} + \frac{\pi}{4}\right) + 2 \ln \left| \sin\left(\frac{x}{2} + \frac{\pi}{4}\right) \right| + C.
$$
简化表达式。首先，$\sin\left(\frac{x}{2} + \frac{\pi}{4}\right) = \frac{\sin \frac{x}{2} + \cos \frac{x}{2}}{\sqrt{2}}$，所以：
$$
2 \ln \left| \sin\left(\frac{x}{2} + \frac{\pi}{4}\right) \right| = 2 \ln \left| \frac{\sin \frac{x}{2} + \cos \frac{x}{2}}{\sqrt{2}} \right| = 2 \ln \left| \sin \frac{x}{2} + \cos \frac{x}{2} \right| - \ln 2.
$$
常数 $-\ln 2$ 可并入常数 $C$。其次，$\cot\left(\frac{x}{2} + \frac{\pi}{4}\right) = \frac{\cos \frac{x}{2} - \sin \frac{x}{2}}{\sin \frac{x}{2} + \cos \frac{x}{2}}$，所以：
$$
-x \cot\left(\frac{x}{2} + \frac{\pi}{4}\right) = -x \frac{\cos \frac{x}{2} - \sin \frac{x}{2}}{\sin \frac{x}{2} + \cos \frac{x}{2}}.
$$
利用恒等式 $\left( \sin \frac{x}{2} + \cos \frac{x}{2} \right)^2 = 1 + \sin x$，有 $\left| \sin \frac{x}{2} + \cos \frac{x}{2} \right| = \sqrt{1 + \sin x}$，所以：
$$
2 \ln \left| \sin \frac{x}{2} + \cos \frac{x}{2} \right| = 2 \ln \sqrt{1 + \sin x} = \ln (1 + \sin x).
$$
又：
$$
\frac{\cos \frac{x}{2} - \sin \frac{x}{2}}{\sin \frac{x}{2} + \cos \frac{x}{2}} = \frac{(1 - \sin x)}{\cos x} = \frac{\cos x}{1 + \sin x},
$$
所以：
$$
-x \frac{\cos \frac{x}{2} - \sin \frac{x}{2}}{\sin \frac{x}{2} + \cos \frac{x}{2}} = -x \frac{\cos x}{1 + \sin x}.
$$
因此，积分结果为：
$$
\ln (1 + \sin x) - \frac{x \cos x}{1 + \sin x} + C.
$$

验证：对结果求导，
$$
\frac{d}{dx} \left[ \ln (1 + \sin x) - \frac{x \cos x}{1 + \sin x} \right] = \frac{\cos x}{1 + \sin x} - \frac{d}{dx} \left( \frac{x \cos x}{1 + \sin x} \right).
$$
其中，
$$
\frac{d}{dx} \left( \frac{x \cos x}{1 + \sin x} \right) = \frac{\cos x}{1 + \sin x} + x \cdot \frac{d}{dx} \left( \frac{\cos x}{1 + \sin x} \right),
$$
$$
\frac{d}{dx} \left( \frac{\cos x}{1 + \sin x} \right) = \frac{-\sin x (1 + \sin x) - \cos x \cdot \cos x}{(1 + \sin x)^2} = \frac{-\sin x - \sin^2 x - \cos^2 x}{(1 + \sin x)^2} = \frac{-\sin x - 1}{(1 + \sin x)^2} = -\frac{1}{1 + \sin x}.
$$
所以，
$$
\frac{d}{dx} \left( \frac{x \cos x}{1 + \sin x} \right) = \frac{\cos x}{1 + \sin x} - \frac{x}{1 + \sin x} = \frac{\cos x - x}{1 + \sin x}.
$$
代回：
$$
\frac{d}{dx} \left[ \ln (1 + \sin x) - \frac{x \cos x}{1 + \sin x} \right] = \frac{\cos x}{1 + \sin x} - \frac{\cos x - x}{1 + \sin x} = \frac{x}{1 + \sin x},
$$
与原被积函数一致。

因此，积分为：
$$
\boxed{\ln \left(1 + \sin x\right) - \dfrac{x \cos x}{1 + \sin x} + C}
$$